<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="Work on version 8 has begun 3 Sep 2021 and is perhaps the biggest update to Fiber yet."><title>v8 Migration Guide</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://mindulle.github.io/garden/icon.png><link href=https://mindulle.github.io/garden/styles.706bb6073ba85d26809f9096dae23a6b.min.css rel=stylesheet><link href=https://mindulle.github.io/garden/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://mindulle.github.io/garden/js/darkmode.71fd764547989a0d567451669afd7a55.min.js></script>
<script src=https://mindulle.github.io/garden/js/util.5e39932758f9ecaf45fd54506ed61416.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://mindulle.github.io/garden/js/popover.6da9b273c092cc16fc1aa904d71a2163.min.js></script>
<script src=https://mindulle.github.io/garden/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://mindulle.github.io/garden/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://mindulle.github.io/garden/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://mindulle.github.io/garden",fetchData=Promise.all([fetch("https://mindulle.github.io/garden/indices/linkIndex.1cc5b93b76189b4bd1ac6a15a7965d69.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://mindulle.github.io/garden/indices/contentIndex.90ef1bca5b632b30b0062af44b52aa0c.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://mindulle.github.io/garden",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!0;drawGraph("https://mindulle.github.io/garden",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'â€™':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/mindulle.github.io\/garden\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://mindulle.github.io/garden/js/full-text-search.51f0b1753e9b30839d053f8a98cc20d1.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://mindulle.github.io/garden>Mindulle GardenðŸŽ‰</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>v8 Migration Guide</h1><p class=meta>Last updated
Dec 28, 2022
<a href=https://github.com/mindulle/garden/tree/hugo/content/Develop/Trees/Dev/Programming/Libs&Fwks/webFrontend/Component/React/React-three/Tutorials/v8%20Migration%20Guide.md rel=noopener>Edit Source</a></p><ul class=tags></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#react-native-support>React Native support</a></li><li><a href=#zustand-and-suspend-react>Zustand and suspend-react</a></li><li><a href=#new-pixel-ratio-default>New pixel ratio default</a></li><li><a href=#color-management>Color management</a></li><li><a href=#automatic-concurrency>Automatic concurrency</a><ol><li><a href=#examples1>Examples1</a></li></ol></li><li><a href=#conditional-rendering-with-frameloop>Conditional rendering with frameloop</a></li><li><a href=#expanded-gl-prop>Expanded gl prop</a></li><li><a href=#improved-webxr-handling>Improved WebXR handling</a><ol><li><a href=#automatic-webxr-switching>Automatic WebXR switching</a></li><li><a href=#extended-useframe>Extended useFrame</a></li></ol></li><li><a href=#manual-camera-manipulation>Manual camera manipulation</a></li><li><a href=#unified-attach-api>Unified attach API</a><ol><li><a href=#real-world-use-cases>Real-world use-cases:</a></li></ol></li><li><a href=#spread-canvas-props>Spread Canvas props</a></li><li><a href=#new-createroot-api>New createRoot API</a><ol><li><a href=#examples2>Examples2</a></li></ol></li><li><a href=#tree-shaking-via-extend>Tree-shaking via extend</a></li><li><a href=#createportal-creates-a-state-enclave>createPortal creates a state enclave</a><ol><li><a href=#examples3>Examples3</a></li></ol></li><li><a href=#rttr-regex-matchers>RTTR Regex Matchers</a></li><li><a href=#deprecated>Deprecated</a></li></ol></nav></details></aside><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-toc data-lang=toc></code></pre></td></tr></table></div></div><p>Work on version 8 has begun 3 Sep 2021 and is perhaps the biggest update to Fiber yet. We&rsquo;ve tried our best to keep breaking-changes to a minimum, they mostly affect rarely used api&rsquo;s like <code>attach</code>. This release brings a ton of performance related fixes, but also includes some new and ground breaking features.</p><p>We would like to express our gratitude to the community for their continued support, as well as to all our contributors. ðŸŽ‰</p><a href=#react-native-support><h2 id=react-native-support><span class=hanchor arialabel=Anchor># </span>React Native support</h2></a><p>With React 18 and Expo 43, you can now ship threejs goodness across web and native. These apps are not confined to a web-view, they are truly native OpenGLES.</p><p>Now expo-gl, which does the hard lifting, has existed for a while, but we&rsquo;ve addressed some of the common concerns related to interop and making the three eco system readily work in the native space. For instance, you handle assets the same exact way you&rsquo;d treat them in a web app.</p><p>See
<a rel=noopener class="internal-link broken" data-src=/react-three-fiber/getting-started/installation#react-native>installation</a> to get started with managed Expo or bare React Native apps.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gd>- import { Canvas, useLoader } from &#39;@react-three/fiber&#39;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ import { Canvas, useLoader } from &#39;@react-three/fiber/native&#39;
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl><span class=gd>- import { useGLTF } from &#39;@react-three/drei&#39;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ import { useGLTF } from &#39;@react-three/drei/native&#39;
</span></span></span></code></pre></td></tr></table></div></div><p>This is complete with support for Pressability events and native threejs loaders. See
<a rel=noopener class="internal-link broken" data-src=/react-three-fiber/api/events>events</a> for a complete list of events.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>mesh</span>
</span></span><span class=line><span class=cl>  <span class=na>onClick</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;onPress&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>  <span class=na>onPointerDown</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;onPressIn&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>  <span class=na>onPointerUp</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;onPressOut&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>  <span class=na>onDoubleClick</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;onLongPress&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>  <span class=na>onPointerOver</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;onHoverIn&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>  <span class=na>onPointerOut</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;onHoverOut&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>  <span class=na>onPointerMove</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;onPressMove&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>  <span class=err>//</span> <span class=na>Not</span> <span class=na>implemented</span>
</span></span><span class=line><span class=cl>  <span class=err>//</span> <span class=na>onContextMenu</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;context menu&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>  <span class=err>//</span> <span class=na>onWheel</span><span class=o>=</span><span class=p>{(</span><span class=nx>e</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=nx>console</span><span class=p>.</span><span class=nx>log</span><span class=p>(</span><span class=s1>&#39;wheel spins&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=p>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=nx>React</span><span class=p>,</span> <span class=p>{</span> <span class=nx>Suspense</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>useGLTF</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-three/drei/native&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Canvas</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-three/fiber/native&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=nx>modelPath</span> <span class=nx>from</span> <span class=s1>&#39;./assets/model.glb&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>Model</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>{</span> <span class=nx>scene</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>useGLTF</span><span class=p>(</span><span class=nx>modelPath</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>&lt;</span><span class=nt>primitive</span> <span class=p>{</span><span class=na>...props</span><span class=p>}</span> <span class=na>object</span><span class=o>=</span><span class=p>{</span><span class=nx>scene</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>export</span> <span class=k>default</span> <span class=kd>function</span> <span class=nx>App</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>Canvas</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;</span><span class=nt>Suspense</span> <span class=na>fallback</span><span class=o>=</span><span class=p>{</span><span class=kc>null</span><span class=p>}&gt;</span>
</span></span><span class=line><span class=cl>        <span class=p>&lt;</span><span class=nt>Model</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>      <span class=p>&lt;/</span><span class=nt>Suspense</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;/</span><span class=nt>Canvas</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>React Native support was submitted by
<a href=https://twitter.com/Cody_J_Bennett rel=noopener>@Cody_J_Bennett</a>. ðŸŽ‰</p><a href=#zustand-and-suspend-react><h2 id=zustand-and-suspend-react><span class=hanchor arialabel=Anchor># </span>Zustand and suspend-react</h2></a><p>Fiber uses
<a href=https://zustand.js.org/ rel=noopener>zustand</a> to manage state. It&rsquo;s a simple, powerful, and performant state management library for React. And
<a href=https://github.com/pmndrs/suspend-react rel=noopener>suspend-react</a> to manage async ops and suspense (useLoader for instance). You can use these in your projects as well as they are to get closer interop with Fiber.</p><a href=#new-pixel-ratio-default><h2 id=new-pixel-ratio-default><span class=hanchor arialabel=Anchor># </span>New pixel ratio default</h2></a><p>The default DPR has changed from <code>1</code> to <code>[1, 2]</code>, which will clamp between 1 and 2, but prefer 2, depending on the screen&rsquo;s native pixel ratio.</p><p>This was the most common setting in the wild, so it was brought in as a better default.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gd>- &lt;Canvas dpr={[1, 2]} /&gt;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ &lt;Canvas /&gt;
</span></span></span></code></pre></td></tr></table></div></div><a href=#color-management><h2 id=color-management><span class=hanchor arialabel=Anchor># </span>Color management</h2></a><p>Color management is now being handled by Three R139. Therefore we set <code>THREE.ColorManagement.legacyMode</code> to <code>false</code> and cede to touch colors and textures since everything will now be converted from sRGB to linear space by Three itself.</p><p>You can manipulate this yourself with the <code>legacy</code> prop:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=c1>// sets THREE.ColorManagement.legacyMode = true
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;</span><span class=nt>Canvas</span> <span class=na>legacy</span><span class=o>=</span><span class=p>{</span><span class=kc>true</span><span class=p>}&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>While you can of course use Fiber with any Three version you like we recommend updating to R139.</p><p>Check out
<a href=https://threejs.org/docs/#manual/en/introduction/Color-management rel=noopener>https://threejs.org/docs/#manual/en/introduction/Color-management</a> for information.</p><a href=#automatic-concurrency><h2 id=automatic-concurrency><span class=hanchor arialabel=Anchor># </span>Automatic concurrency</h2></a><p>Concurrency is now part of React 18, which automatically switches between blocking (default) and concurrent (async).</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gd>- &lt;Canvas mode=&#34;concurrent&#34; /&gt;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ &lt;Canvas /&gt;
</span></span></span></code></pre></td></tr></table></div></div><p>React 18 introduces the <code>startTransition</code> and <code>useTransition</code> APIs to defer and schedule expensive operations and state updates. Use these to de-prioritize expensive operations.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>startTransition</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;react&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Points</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-three/drei&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>[</span><span class=nx>radius</span><span class=p>,</span> <span class=nx>setRadius</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>positions</span> <span class=o>=</span> <span class=nx>calculatePositions</span><span class=p>(</span><span class=nx>radius</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>colors</span> <span class=o>=</span> <span class=nx>calculateColors</span><span class=p>(</span><span class=nx>radius</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>sizes</span> <span class=o>=</span> <span class=nx>calculateSizes</span><span class=p>(</span><span class=nx>radius</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>Points</span>
</span></span><span class=line><span class=cl>  <span class=na>positions</span><span class=o>=</span><span class=p>{</span><span class=nx>positions</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=na>colors</span><span class=o>=</span><span class=p>{</span><span class=nx>colors</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=na>sizes</span><span class=o>=</span><span class=p>{</span><span class=nx>sizes</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=na>onPointerOut</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>startTransition</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=nx>setRadius</span><span class=p>(</span><span class=nx>prev</span> <span class=p>=&gt;</span> <span class=nx>prev</span> <span class=o>+</span> <span class=mi>1</span><span class=p>))}</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>meshBasicMaterial</span> <span class=na>vertexColors</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>Points</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><a href=#examples1><h3 id=examples1><span class=hanchor arialabel=Anchor># </span>Examples1</h3></a><p>Please be careful, this is an extreme stress test. It creates so much load that without React the browser will freeze or crash.</p><p><a href=https://codesandbox.io/s/qjo4t><img width=49% src=https://codesandbox.io/api/v1/sandboxes/qjo4t/screenshot.png alt="View splitting"></a></p><a href=#conditional-rendering-with-frameloop><h2 id=conditional-rendering-with-frameloop><span class=hanchor arialabel=Anchor># </span>Conditional rendering with frameloop</h2></a><p><code>frameloop</code> can now be toggled to render conditionally. This is useful to toggle on user interaction or while in frame.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=p>[</span><span class=nx>frameloop</span><span class=p>,</span> <span class=nx>setFrameloop</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;never&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>Canvas</span>
</span></span><span class=line><span class=cl>  <span class=na>frameloop</span><span class=o>=</span><span class=p>{</span><span class=nx>frameloop</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=na>onClick</span><span class=o>=</span><span class=p>{()</span> <span class=p>=&gt;</span> <span class=nx>setFrameloop</span><span class=p>(</span><span class=s1>&#39;always&#39;</span><span class=p>)}</span>
</span></span><span class=line><span class=cl><span class=p>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>Another usecase would be using intersection observers to stop the canvas when it&rsquo;s out of view.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>const</span> <span class=nx>canvasRef</span> <span class=o>=</span> <span class=nx>useRef</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=p>[</span><span class=nx>frameloop</span><span class=p>,</span> <span class=nx>setFrameloop</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(</span><span class=s1>&#39;never&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>useEffect</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=nx>observer</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>IntersectionObserver</span><span class=p>(([{</span> <span class=nx>isIntersecting</span> <span class=p>}])</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>setFrameloop</span><span class=p>(</span><span class=nx>isIntersecting</span> <span class=o>?</span> <span class=s1>&#39;always&#39;</span> <span class=o>:</span> <span class=s1>&#39;never&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span> <span class=p>{})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>observer</span><span class=p>.</span><span class=nx>observe</span><span class=p>(</span><span class=nx>canvasRef</span><span class=p>.</span><span class=nx>current</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>observer</span><span class=p>.</span><span class=nx>disconnect</span><span class=p>()</span>
</span></span><span class=line><span class=cl><span class=p>},</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>Canvas</span> <span class=na>ref</span><span class=o>=</span><span class=p>{</span><span class=nx>canvasRef</span><span class=p>}</span> <span class=na>frameloop</span><span class=o>=</span><span class=p>{</span><span class=nx>frameloop</span><span class=p>}</span> <span class=p>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><a href=#expanded-gl-prop><h2 id=expanded-gl-prop><span class=hanchor arialabel=Anchor># </span>Expanded gl prop</h2></a><p>The <code>gl</code> prop can now accept both constructor args and renderer properties like the <code>camera</code> prop.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>Canvas</span> <span class=na>gl</span><span class=o>=</span><span class=p>{{</span> <span class=nx>alpha</span><span class=o>:</span> <span class=kc>false</span><span class=p>,</span> <span class=nx>physicallyCorrectLights</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}}</span> <span class=p>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>It can also accept a synchronous callback to manually create a renderer. This allows you to use any custom renderer you want.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>Canvas</span> <span class=na>gl</span><span class=o>=</span><span class=p>{(</span><span class=nx>canvas</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=nx>Renderer</span><span class=p>({</span> <span class=nx>canvas</span> <span class=p>})}</span> <span class=p>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><a href=#improved-webxr-handling><h2 id=improved-webxr-handling><span class=hanchor arialabel=Anchor># </span>Improved WebXR handling</h2></a><a href=#automatic-webxr-switching><h3 id=automatic-webxr-switching><span class=hanchor arialabel=Anchor># </span>Automatic WebXR switching</h3></a><p>The <code>vr</code> prop was removed in favor of automatic WebXR switching. Whenever a session is requested, XR features are enabled, and the renderer will render at the native refresh rate. The inverse is true when exiting a session.</p><blockquote><p><code>frameloop</code> will not be respected while in a session.</p></blockquote><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gd>- &lt;Canvas vr /&gt;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ &lt;Canvas /&gt;
</span></span></span></code></pre></td></tr></table></div></div><a href=#extended-useframe><h3 id=extended-useframe><span class=hanchor arialabel=Anchor># </span>Extended useFrame</h3></a><p>In addition to the automatic rendering, useFrame will expose the current
<a href=https://developer.mozilla.org/en-US/docs/Web/API/XRFrame rel=noopener><code>XRFrame</code></a> obtained via
<a href=https://developer.mozilla.org/en-US/docs/Web/API/XRSession/requestAnimationFrame rel=noopener>XRSession#requestAnimationFrame</a>.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>useFrame</span><span class=p>((</span><span class=nx>state</span>: <span class=kt>RootState</span><span class=p>,</span> <span class=nx>delta</span>: <span class=kt>number</span><span class=p>,</span> <span class=nx>frame?</span>: <span class=kt>THREE.XRFrame</span><span class=p>)</span> <span class=o>=&gt;</span> <span class=p>{</span> <span class=p>...</span> <span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>This removes the need for custom rendering loops when using WebXR pose data and abstractions like <code>useXRFrame</code> of
<a href=https://github.com/pmndrs/react-xr rel=noopener>@react-three/xr</a>.</p><a href=#manual-camera-manipulation><h2 id=manual-camera-manipulation><span class=hanchor arialabel=Anchor># </span>Manual camera manipulation</h2></a><p>By default Fiber is responsive and will set up cameras properly on resize (aspect ratio etc).</p><p>Cameras can be controlled manually by setting <code>manual</code> to true in <code>camera</code>. This will opt out of projection matrix recalculation when the drawing area resizes.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>Canvas</span> <span class=na>camera</span><span class=o>=</span><span class=p>{{</span> <span class=nx>manual</span><span class=o>:</span> <span class=kc>true</span> <span class=p>}}&gt;</span>
</span></span></code></pre></td></tr></table></div></div><p>This is also supported by all cameras that you create, be it a THREE.PerspectiveCamera or drei/cameras, put <code>manual</code> on it and Fiber will not touch it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>PerspectiveCamera</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-three/drei&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>;&lt;</span><span class=nt>Canvas</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>PerspectiveCamera</span> <span class=na>makeDefault</span> <span class=na>manual</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;/</span><span class=nt>Canvas</span><span class=p>&gt;</span>
</span></span></code></pre></td></tr></table></div></div><a href=#unified-attach-api><h2 id=unified-attach-api><span class=hanchor arialabel=Anchor># </span>Unified attach API</h2></a><p>Previously, attach had multiple signatures:</p><ul><li><code>attach="name"</code></li><li><code>attachObject={["name", "attribute"]}</code></li><li><code>attachArray="name"</code></li><li><code>attachFns={["add", "remove"]}</code></li><li><code>attachFns={[(self, parent) => parent.add(self), (self, parent) => parent.remove(self)]}</code></li></ul><p>This is now a single, unified signature with support for piercing and named attach functions or custom handlers.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=c1>// Attach foo to parent.a
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;</span><span class=nt>foo</span> <span class=na>attach</span><span class=o>=</span><span class=s>&#34;a&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Attach foo to parent.a.b and a.b.c (nested object attach)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;</span><span class=nt>foo</span> <span class=na>attach</span><span class=o>=</span><span class=s>&#34;a-b&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>foo</span> <span class=na>attach</span><span class=o>=</span><span class=s>&#34;a-b-c&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Attach foo to parent.a[0] and [1] (array attach is just object attach)
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;</span><span class=nt>foo</span> <span class=na>attach</span><span class=o>=</span><span class=s>&#34;a-0&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl><span class=p>&lt;</span><span class=nt>foo</span> <span class=na>attach</span><span class=o>=</span><span class=s>&#34;a-1&#34;</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Attach foo to parent via explicit add/remove functions
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;</span><span class=nt>foo</span> <span class=na>attach</span><span class=o>=</span><span class=p>{(</span><span class=nx>parent</span><span class=p>,</span> <span class=nx>self</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>parent</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>parent</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=nx>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span> <span class=o>/&gt;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// The same as a one liner
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=p>&lt;</span><span class=nt>foo</span> <span class=na>attach</span><span class=o>=</span><span class=p>{(</span><span class=nx>parent</span><span class=p>,</span> <span class=nx>self</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>(</span><span class=nx>parent</span><span class=p>.</span><span class=nx>add</span><span class=p>(</span><span class=nx>self</span><span class=p>),</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=nx>parent</span><span class=p>.</span><span class=nx>remove</span><span class=p>(</span><span class=nx>self</span><span class=p>))}</span> <span class=p>/&gt;</span>
</span></span></code></pre></td></tr></table></div></div><a href=#real-world-use-cases><h3 id=real-world-use-cases><span class=hanchor arialabel=Anchor># </span>Real-world use-cases:</h3></a><p>Attaching to nested objects:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gd>- &lt;directionalLight
</span></span></span><span class=line><span class=cl><span class=gd>-   castShadow
</span></span></span><span class=line><span class=cl><span class=gd>-   position={[2.5, 8, 5]}
</span></span></span><span class=line><span class=cl><span class=gd>-   shadow-mapSize={[1024, 1024]}
</span></span></span><span class=line><span class=cl><span class=gd>-   shadow-camera-far={50}
</span></span></span><span class=line><span class=cl><span class=gd>-   shadow-camera-left={-10}
</span></span></span><span class=line><span class=cl><span class=gd>-   shadow-camera-right={10}
</span></span></span><span class=line><span class=cl><span class=gd>-   shadow-camera-top={10}
</span></span></span><span class=line><span class=cl><span class=gd>-   shadow-camera-bottom={-10}
</span></span></span><span class=line><span class=cl><span class=gd>- /&gt;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ &lt;directionalLight castShadow position={[2.5, 8, 5]} shadow-mapSize={[1024, 1024]}&gt;
</span></span></span><span class=line><span class=cl><span class=gi>+   &lt;orthographicCamera attach=&#34;shadow-camera&#34; args={[-10, 10, 10, -10]} /&gt;
</span></span></span><span class=line><span class=cl><span class=gi>+ &lt;/directionalLight&gt;
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>&lt;bufferGeometry&gt;
</span></span><span class=line><span class=cl><span class=gd>-   &lt;bufferAttribute attachObject={[&#39;attributes&#39;, &#39;position&#39;]} count={count} array={vertices} itemSize={3} /&gt;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+   &lt;bufferAttribute attach=&#34;attributes-position&#34; count={count} array={vertices} itemSize={3} /&gt;
</span></span></span><span class=line><span class=cl><span class=gi></span>&lt;/bufferGeometry&gt;
</span></span></code></pre></td></tr></table></div></div><p>Arrays must be explcit now:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>&lt;mesh&gt;
</span></span><span class=line><span class=cl><span class=gd>-  {colors.map((color, index) =&gt; &lt;meshBasicMaterial key={index} attachArray=&#34;material&#34; color={color} /&gt;)}
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+  {colors.map((color, index) =&gt; &lt;meshBasicMaterial key={index} attach={`material-${index}`} color={color} /&gt;)}
</span></span></span><span class=line><span class=cl><span class=gi></span>&lt;/mesh&gt;
</span></span></code></pre></td></tr></table></div></div><a href=#spread-canvas-props><h2 id=spread-canvas-props><span class=hanchor arialabel=Anchor># </span>Spread Canvas props</h2></a><p>The <code>&lt;Canvas /></code> can now accept non-render props to spread as native props: styles, classes, events, a11y, &mldr;</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl><span class=gd>- &lt;div aria-describedby={...}&gt;
</span></span></span><span class=line><span class=cl><span class=gd>-  &lt;Canvas /&gt;
</span></span></span><span class=line><span class=cl><span class=gd>- &lt;/div&gt;
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ &lt;Canvas aria-describedby={...} /&gt;
</span></span></span></code></pre></td></tr></table></div></div><a href=#new-createroot-api><h2 id=new-createroot-api><span class=hanchor arialabel=Anchor># </span>New createRoot API</h2></a><p><code>render</code> is depreciated in v8 for the new <code>createRoot</code> signature.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>import {
</span></span><span class=line><span class=cl><span class=gd>- render,
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ createRoot,
</span></span></span><span class=line><span class=cl><span class=gi></span>  events
</span></span><span class=line><span class=cl>} from &#39;@react-three/fiber&#39;
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=gd>- render(&lt;mesh /&gt;, canvas, { event })
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ createRoot(canvas).configure({ events }).render(&lt;mesh /&gt;)
</span></span></span></code></pre></td></tr></table></div></div><p>Here is a typical setup:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=o>*</span> <span class=nx>as</span> <span class=nx>THREE</span> <span class=nx>from</span> <span class=s1>&#39;three&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>extend</span><span class=p>,</span> <span class=nx>createRoot</span><span class=p>,</span> <span class=nx>events</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-three/fiber&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>extend</span><span class=p>(</span><span class=nx>THREE</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>root</span> <span class=o>=</span> <span class=nx>createRoot</span><span class=p>(</span><span class=nb>document</span><span class=p>.</span><span class=nx>querySelector</span><span class=p>(</span><span class=s1>&#39;#root&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>addEventListener</span><span class=p>(</span><span class=s1>&#39;resize&#39;</span><span class=p>,</span> <span class=p>()</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>root</span><span class=p>.</span><span class=nx>configure</span><span class=p>({</span>
</span></span><span class=line><span class=cl>    <span class=nx>events</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>camera</span><span class=o>:</span> <span class=p>{</span> <span class=nx>position</span><span class=o>:</span> <span class=p>[</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>50</span><span class=p>],</span> <span class=nx>fov</span><span class=o>:</span> <span class=mi>50</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nx>size</span><span class=o>:</span> <span class=p>{</span> <span class=nx>width</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>innerWidth</span><span class=p>,</span> <span class=nx>height</span><span class=o>:</span> <span class=nb>window</span><span class=p>.</span><span class=nx>innerHeight</span> <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl>  <span class=nx>root</span><span class=p>.</span><span class=nx>render</span><span class=p>(&lt;</span><span class=nt>App</span> <span class=p>/&gt;)</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl><span class=nb>window</span><span class=p>.</span><span class=nx>dispatchEvent</span><span class=p>(</span><span class=k>new</span> <span class=nx>Event</span><span class=p>(</span><span class=s1>&#39;resize&#39;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// This is how you would unmount the root
</span></span></span><span class=line><span class=cl><span class=c1>// root.unmount()
</span></span></span></code></pre></td></tr></table></div></div><a href=#examples2><h3 id=examples2><span class=hanchor arialabel=Anchor># </span>Examples2</h3></a><p>This is a custom-renderer example using the createRoot api:</p><p><a href=https://codesandbox.io/s/zcuqh><img width=49% src=https://codesandbox.io/api/v1/sandboxes/zcuqh/screenshot.png alt="View splitting"></a></p><a href=#tree-shaking-via-extend><h2 id=tree-shaking-via-extend><span class=hanchor arialabel=Anchor># </span>Tree-shaking via extend</h2></a><p>The underlying reconciler no longer pulls in the THREE namespace automatically.</p><p>This enables a granular catalogue and tree-shaking via the <code>extend</code> API:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>extend</span><span class=p>,</span> <span class=nx>createRoot</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-three/fiber&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Mesh</span><span class=p>,</span> <span class=nx>BoxGeometry</span><span class=p>,</span> <span class=nx>MeshStandardMaterial</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;three&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>extend</span><span class=p>({</span> <span class=nx>Mesh</span><span class=p>,</span> <span class=nx>BoxGeometry</span><span class=p>,</span> <span class=nx>MeshStandardMaterial</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>createRoot</span><span class=p>(</span><span class=nx>canvas</span><span class=p>).</span><span class=nx>render</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>mesh</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>boxGeometry</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meshStandardMaterial</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>mesh</span><span class=p>&gt;,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>There&rsquo;s an
<a href=https://github.com/pmndrs/react-three-babel rel=noopener>official babel plugin</a> which will do this for you automatically:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=c1>// In:
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createRoot</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-three/fiber&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>createRoot</span><span class=p>(</span><span class=nx>canvasNode</span><span class=p>).</span><span class=nx>render</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>mesh</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>boxGeometry</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meshStandardMaterial</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>mesh</span><span class=p>&gt;,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Out:
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createRoot</span><span class=p>,</span> <span class=nx>extend</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-three/fiber&#39;</span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>Mesh</span> <span class=nx>as</span> <span class=nx>_Mesh</span><span class=p>,</span> <span class=nx>BoxGeometry</span> <span class=nx>as</span> <span class=nx>_BoxGeometry</span><span class=p>,</span> <span class=nx>MeshStandardMaterial</span> <span class=nx>as</span> <span class=nx>_MeshStandardMaterial</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;three&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>extend</span><span class=p>({</span>
</span></span><span class=line><span class=cl>  <span class=nx>Mesh</span><span class=o>:</span> <span class=nx>_Mesh</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>BoxGeometry</span><span class=o>:</span> <span class=nx>_BoxGeometry</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>MeshStandardMaterial</span><span class=o>:</span> <span class=nx>_MeshStandardMaterial</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nx>createRoot</span><span class=p>(</span><span class=nx>canvasNode</span><span class=p>).</span><span class=nx>render</span><span class=p>(</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;</span><span class=nt>mesh</span><span class=p>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>boxGeometry</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>    <span class=p>&lt;</span><span class=nt>meshStandardMaterial</span> <span class=p>/&gt;</span>
</span></span><span class=line><span class=cl>  <span class=p>&lt;/</span><span class=nt>mesh</span><span class=p>&gt;,</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>No changes are necessary for <code>@react-three/test-renderer</code> as THREE is extended automatically.</p><a href=#createportal-creates-a-state-enclave><h2 id=createportal-creates-a-state-enclave><span class=hanchor arialabel=Anchor># </span>createPortal creates a state enclave</h2></a><p><code>createPortal</code> allows you to write a declarative JSX scene into a pre-existing, foreign object. This has been very useful for portals, heads-up displays, view-cubes, view splitting, etc.</p><p>But these things were very limited and lacked event support as well as support for eco-system packages (for instance putting OrbitControls into a split view).</p><p>With this release <code>createPortal</code> creates a virtual state-model in which everything keeps functioning. Events work, you can use any 3rd party eco-system control and throw it in there.</p><p>The event layering part of this was submitted by
<a href=https://twitter.com/theatre_js rel=noopener>@theatre_js</a> and
<a href=https://twitter.com/AndrewPrifer rel=noopener>@AndrewPrifer</a> ðŸŽ‰.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=kr>import</span> <span class=p>{</span> <span class=nx>createPortal</span> <span class=p>}</span> <span class=nx>from</span> <span class=s1>&#39;@react-three/fiber&#39;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>function</span> <span class=nx>HeadsUpDisplay</span><span class=p>({</span> <span class=nx>children</span> <span class=p>})</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kr>const</span> <span class=p>[</span><span class=nx>scene</span><span class=p>]</span> <span class=o>=</span> <span class=nx>useState</span><span class=p>(()</span> <span class=p>=&gt;</span> <span class=k>new</span> <span class=nx>THREE</span><span class=p>.</span><span class=nx>Scene</span><span class=p>())</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span> <span class=nx>createPortal</span><span class=p>(</span><span class=nx>children</span><span class=p>,</span> <span class=nx>scene</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=cm>/* Override RootState here */</span>
</span></span><span class=line><span class=cl>  <span class=p>})</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The event system in particular can now be layered, so that you can have portals inside portals with event priority. You can also inject objects into RootState right away, these will become the defaults inside the portalled state world and anything using <code>useThree</code> inside will receive these objects.</p><p>Here is an example of a layered portal:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-jsx data-lang=jsx><span class=line><span class=cl><span class=nx>createPortal</span><span class=p>(</span><span class=nx>children</span><span class=p>,</span> <span class=nx>scene</span><span class=p>,</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nx>camera</span><span class=o>:</span> <span class=nx>myCustomCamera</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nx>events</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>priority</span><span class=o>:</span> <span class=nx>previousPriority</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nx>compute</span><span class=o>:</span> <span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>state</span><span class=p>,</span> <span class=nx>previous</span><span class=p>)</span> <span class=p>=&gt;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=c1>// First we call the previous state-onion-layers compute, this is what makes it possible to nest portals
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>previous</span><span class=p>.</span><span class=nx>raycaster</span><span class=p>.</span><span class=nx>camera</span><span class=p>)</span> <span class=nx>previous</span><span class=p>.</span><span class=nx>events</span><span class=p>.</span><span class=nx>compute</span><span class=p>(</span><span class=nx>event</span><span class=p>,</span> <span class=nx>previous</span><span class=p>,</span> <span class=nx>previous</span><span class=p>.</span><span class=nx>previousRoot</span><span class=p>.</span><span class=nx>getState</span><span class=p>())</span>
</span></span><span class=line><span class=cl>      <span class=c1>// We run a quick check against the textured plane itself, if it isn&#39;t hit there&#39;s no need to raycast at all
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=p>[</span><span class=nx>intersection</span><span class=p>]</span> <span class=o>=</span> <span class=nx>previous</span><span class=p>.</span><span class=nx>raycaster</span><span class=p>.</span><span class=nx>intersectObject</span><span class=p>(</span><span class=nx>ref</span><span class=p>.</span><span class=nx>current</span><span class=p>)</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=o>!</span><span class=nx>intersection</span><span class=p>)</span> <span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>      <span class=c1>// We take that hits uv coords, set up this layers raycaster, et voilÃ , we have raycasting with perspective shift
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=kr>const</span> <span class=nx>uv</span> <span class=o>=</span> <span class=nx>intersection</span><span class=p>.</span><span class=nx>uv</span>
</span></span><span class=line><span class=cl>      <span class=nx>state</span><span class=p>.</span><span class=nx>raycaster</span><span class=p>.</span><span class=nx>setFromCamera</span><span class=p>(</span><span class=nx>state</span><span class=p>.</span><span class=nx>pointer</span><span class=p>.</span><span class=nx>set</span><span class=p>(</span><span class=nx>uv</span><span class=p>.</span><span class=nx>x</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>-</span> <span class=mi>1</span><span class=p>,</span> <span class=nx>uv</span><span class=p>.</span><span class=nx>y</span> <span class=o>*</span> <span class=mi>2</span> <span class=o>-</span> <span class=mi>1</span><span class=p>),</span> <span class=nx>camera</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p><code>createPortal</code> can still be considered low-level and the exact API for <code>compute</code> is still experimental at this point. Expect ready-made components for portals, hud&rsquo;s and view-splitting to come to drei soon.</p><a href=#examples3><h3 id=examples3><span class=hanchor arialabel=Anchor># </span>Examples3</h3></a><p><a href=https://codesandbox.io/s/1wmlew><img width=49% src=https://codesandbox.io/api/v1/sandboxes/1wmlew/screenshot.png alt="View splitting"></a>
<a href=https://codesandbox.io/s/kp1w5u><img width=49% src=https://codesandbox.io/api/v1/sandboxes/kp1w5u/screenshot.png alt=Portals></a>
<a href=https://codesandbox.io/s/dioqhj><img width=49% src=https://codesandbox.io/api/v1/sandboxes/dioqhj/screenshot.png alt="Heads-up displays"></a></p><a href=#rttr-regex-matchers><h2 id=rttr-regex-matchers><span class=hanchor arialabel=Anchor># </span>RTTR Regex Matchers</h2></a><p>test-renderer&rsquo;s <code>findByProps</code> and <code>findAllByProps</code> now accept RegExp matchers to search for variable or computed properties.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>testInstance</span><span class=p>.</span><span class=nx>findByProps</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Also accepts RegExp matchers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>testInstance</span><span class=p>.</span><span class=nx>findByProps</span><span class=p>({</span> <span class=p>[</span><span class=nx>prop</span><span class=p>]</span><span class=o>:</span> <span class=sr>/^match/i</span> <span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=nx>testInstance</span><span class=p>.</span><span class=nx>findAllByProps</span><span class=p>(</span><span class=nx>props</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Also accepts RegExp matchers
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=nx>testInstance</span><span class=p>.</span><span class=nx>findAllByProps</span><span class=p>({</span> <span class=p>[</span><span class=nx>prop</span><span class=p>]</span><span class=o>:</span> <span class=sr>/^matches/i</span> <span class=p>})</span>
</span></span></code></pre></td></tr></table></div></div><p>React-three-test-renderer was submitted by
<a href=https://twitter.com/_josh_ellis_ rel=noopener>@<em>josh_ellis</em></a> ðŸŽ‰.</p><a href=#deprecated><h2 id=deprecated><span class=hanchor arialabel=Anchor># </span>Deprecated</h2></a><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>useFrame((state) =&gt; {
</span></span><span class=line><span class=cl><span class=gd>- state.mouse
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ state.pointer
</span></span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-diff data-lang=diff><span class=line><span class=cl>onClick={(event) =&gt; {
</span></span><span class=line><span class=cl><span class=gd>- event.sourceEvent
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ event.nativeEvent
</span></span></span><span class=line><span class=cl><span class=gi></span>
</span></span><span class=line><span class=cl><span class=gd>- event.spaceX
</span></span></span><span class=line><span class=cl><span class=gd>- event.spaceY
</span></span></span><span class=line><span class=cl><span class=gd></span><span class=gi>+ event.pointer
</span></span></span></code></pre></td></tr></table></div></div></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://mindulle.github.io/garden/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Mindulle using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, Â© 2023</p><ul><li><a href=https://mindulle.github.io/garden>Home</a></li><li><a href=https://github.com/mindulle>Github</a></li></ul></footer></div></div></body></html>