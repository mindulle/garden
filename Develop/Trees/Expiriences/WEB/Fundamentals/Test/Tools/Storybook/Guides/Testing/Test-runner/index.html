<!doctype html><html lang=en><head><meta charset=utf-8><meta name=description content="1  style: bullet   Storybook test runner turns all of your stories into executable tests. It is powered by Jest and Playwright."><title>Test runner</title><meta name=viewport content="width=device-width,initial-scale=1"><link rel="shortcut icon" type=image/png href=https://mindulle.github.io/garden/icon.png><link href=https://mindulle.github.io/garden/styles.706bb6073ba85d26809f9096dae23a6b.min.css rel=stylesheet><link href=https://mindulle.github.io/garden/styles/_light_syntax.86a48a52faebeaaf42158b72922b1c90.min.css rel=stylesheet id=theme-link><script src=https://mindulle.github.io/garden/js/darkmode.71fd764547989a0d567451669afd7a55.min.js></script>
<script src=https://mindulle.github.io/garden/js/util.5e39932758f9ecaf45fd54506ed61416.min.js></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css integrity=sha384-R4558gYOUz8mP9YWpZJjofhk+zx0AS11p36HnD2ZKj/6JR5z27gSSULCNHIRReVs crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js integrity=sha384-z1fJDqw8ZApjGO3/unPWUPsIymfsJmyrDVWC8Tv/a1HeOtGmkwNd/7xUS0Xcnvsx crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/contrib/copy-tex.min.js integrity=sha384-ww/583aHhxWkz5DEVn6OKtNiIaLi2iBRNZXfJRiY1Ai7tnJ9UXpEsyvOITVpTl4A crossorigin=anonymous></script>
<script src=https://unpkg.com/@floating-ui/core@0.7.3></script>
<script src=https://unpkg.com/@floating-ui/dom@0.5.4></script>
<script src=https://mindulle.github.io/garden/js/popover.6da9b273c092cc16fc1aa904d71a2163.min.js></script>
<script src=https://mindulle.github.io/garden/js/code-title.b35124ad8db0ba37162b886afb711cbc.min.js></script>
<script src=https://mindulle.github.io/garden/js/clipboard.c20857734e53a3fb733b7443879efa61.min.js></script>
<script src=https://mindulle.github.io/garden/js/callouts.7723cac461d613d118ee8bb8216b9838.min.js></script>
<script>const SEARCH_ENABLED=!1,LATEX_ENABLED=!0,PRODUCTION=!0,BASE_URL="https://mindulle.github.io/garden",fetchData=Promise.all([fetch("https://mindulle.github.io/garden/indices/linkIndex.a8bca2ddde3c14dc2974bedaed98539b.min.json").then(e=>e.json()).then(e=>({index:e.index,links:e.links})),fetch("https://mindulle.github.io/garden/indices/contentIndex.a7db6164b00d463e2e0a1b51fce02a5f.min.json").then(e=>e.json())]).then(([{index:e,links:t},n])=>({index:e,links:t,content:n})),render=()=>{const e=new URL(BASE_URL),t=e.pathname,n=window.location.pathname,s=t==n;addCopyButtons(),addTitleToCodeBlocks(),addCollapsibleCallouts(),initPopover("https://mindulle.github.io/garden",!0);const o=document.getElementById("footer");if(o){const e=document.getElementById("graph-container");if(!e)return requestAnimationFrame(render);e.textContent="";const t=s&&!1;drawGraph("https://mindulle.github.io/garden",t,[{"/moc":"#4388cc"}],t?{centerForce:1,depth:-1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.5,linkDistance:1,opacityScale:3,repelForce:1,scale:1.4}:{centerForce:1,depth:1,enableDrag:!0,enableLegend:!1,enableZoom:!0,fontSize:.6,linkDistance:1,opacityScale:3,repelForce:2,scale:1.2})}var i=document.getElementsByClassName("mermaid");i.length>0&&import("https://unpkg.com/mermaid@9/dist/mermaid.esm.min.mjs").then(e=>{e.default.init()})},init=(e=document)=>{addCopyButtons(),addTitleToCodeBlocks(),renderMathInElement(e.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],macros:{'’':"'"},throwOnError:!1})}</script><script type=module>
    import { attachSPARouting } from "https:\/\/mindulle.github.io\/garden\/js\/router.9d4974281069e9ebb189f642ae1e3ca2.min.js"
    attachSPARouting(init, render)
  </script></head><script async src="https://www.googletagmanager.com/gtag/js?id=G-XYFD95KB4J"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-XYFD95KB4J",{anonymize_ip:!1})}</script><body><div id=search-container><div id=search-space><input autocomplete=off id=search-bar name=search type=text aria-label=Search placeholder="Search for something..."><div id=results-container></div></div></div><script src=https://cdn.jsdelivr.net/npm/flexsearch@0.7.21/dist/flexsearch.bundle.js integrity="sha256-i3A0NZGkhsKjVMzFxv3ksk0DZh3aXqu0l49Bbh0MdjE=" crossorigin=anonymous defer></script>
<script defer src=https://mindulle.github.io/garden/js/full-text-search.51f0b1753e9b30839d053f8a98cc20d1.min.js></script><div class=singlePage><header><h1 id=page-title><a href=https://mindulle.github.io/garden>Mindulle Garden🎉</a></h1><div class=spacer></div><div id=search-icon><p>Search</p><svg tabindex="0" aria-labelledby="title desc" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 19.9 19.7"><title id="title">Search Icon</title><desc id="desc">Icon to open search</desc><g class="search-path" fill="none"><path stroke-linecap="square" d="M18.5 18.3l-5.4-5.4"/><circle cx="8" cy="8" r="7"/></g></svg></div><div class=darkmode><input class=toggle id=darkmode-toggle type=checkbox tabindex=-1>
<label id=toggle-label-light for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="dayIcon" viewBox="0 0 35 35" style="enable-background:new 0 0 35 35"><title>Light Mode</title><path d="M6 17.5C6 16.672 5.328 16 4.5 16h-3C.672 16 0 16.672.0 17.5S.672 19 1.5 19h3C5.328 19 6 18.328 6 17.5zM7.5 26c-.414.0-.789.168-1.061.439l-2 2C4.168 28.711 4 29.086 4 29.5 4 30.328 4.671 31 5.5 31c.414.0.789-.168 1.06-.44l2-2C8.832 28.289 9 27.914 9 27.5 9 26.672 8.329 26 7.5 26zm10-20C18.329 6 19 5.328 19 4.5v-3C19 .672 18.329.0 17.5.0S16 .672 16 1.5v3C16 5.328 16.671 6 17.5 6zm10 3c.414.0.789-.168 1.06-.439l2-2C30.832 6.289 31 5.914 31 5.5 31 4.672 30.329 4 29.5 4c-.414.0-.789.168-1.061.44l-2 2C26.168 6.711 26 7.086 26 7.5 26 8.328 26.671 9 27.5 9zM6.439 8.561C6.711 8.832 7.086 9 7.5 9 8.328 9 9 8.328 9 7.5c0-.414-.168-.789-.439-1.061l-2-2C6.289 4.168 5.914 4 5.5 4 4.672 4 4 4.672 4 5.5c0 .414.168.789.439 1.06l2 2.001zM33.5 16h-3c-.828.0-1.5.672-1.5 1.5s.672 1.5 1.5 1.5h3c.828.0 1.5-.672 1.5-1.5S34.328 16 33.5 16zM28.561 26.439C28.289 26.168 27.914 26 27.5 26c-.828.0-1.5.672-1.5 1.5.0.414.168.789.439 1.06l2 2C28.711 30.832 29.086 31 29.5 31c.828.0 1.5-.672 1.5-1.5.0-.414-.168-.789-.439-1.061l-2-2zM17.5 29c-.829.0-1.5.672-1.5 1.5v3c0 .828.671 1.5 1.5 1.5s1.5-.672 1.5-1.5v-3C19 29.672 18.329 29 17.5 29zm0-22C11.71 7 7 11.71 7 17.5S11.71 28 17.5 28 28 23.29 28 17.5 23.29 7 17.5 7zm0 18c-4.136.0-7.5-3.364-7.5-7.5s3.364-7.5 7.5-7.5 7.5 3.364 7.5 7.5S21.636 25 17.5 25z"/></svg></label><label id=toggle-label-dark for=darkmode-toggle tabindex=-1><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="nightIcon" viewBox="0 0 100 100" style="enable-background='new 0 0 100 100'"><title>Dark Mode</title><path d="M96.76 66.458c-.853-.852-2.15-1.064-3.23-.534-6.063 2.991-12.858 4.571-19.655 4.571C62.022 70.495 50.88 65.88 42.5 57.5 29.043 44.043 25.658 23.536 34.076 6.47c.532-1.08.318-2.379-.534-3.23-.851-.852-2.15-1.064-3.23-.534-4.918 2.427-9.375 5.619-13.246 9.491-9.447 9.447-14.65 22.008-14.65 35.369.0 13.36 5.203 25.921 14.65 35.368s22.008 14.65 35.368 14.65c13.361.0 25.921-5.203 35.369-14.65 3.872-3.871 7.064-8.328 9.491-13.246C97.826 68.608 97.611 67.309 96.76 66.458z"/></svg></label></div></header><article><h1>Test runner</h1><p class=meta>Last updated
Dec 11, 2022
<a href=https://github.com/mindulle/garden/tree/hugo/content/Develop/Trees/Expiriences/WEB/Fundamentals/Test/Tools/Storybook/Guides/Testing/Test%20runner.md rel=noopener>Edit Source</a></p><ul class=tags><li><a href=https://mindulle.github.io/garden/tags/tree/>Tree</a></li><li><a href=https://mindulle.github.io/garden/tags/storybook/>Storybook</a></li><li><a href=https://mindulle.github.io/garden/tags/test/>Test</a></li><li><a href=https://mindulle.github.io/garden/tags/web/>Web</a></li></ul><aside class=mainTOC><details><summary>Table of Contents</summary><nav id=TableOfContents><ol><li><a href=#setup>Setup</a></li><li><a href=#configure>Configure</a><ol><li><a href=#cli-options>CLI Options</a></li><li><a href=#run-tests-against-a-deployed-storybook>Run tests against a deployed Storybook</a></li></ol></li><li><a href=#set-up-ci-to-run-tests>Set up CI to run tests</a><ol><li><a href=#run-against-deployed-storybooks-via-github-actions-deployment>Run against deployed Storybooks via Github Actions deployment</a></li><li><a href=#run-against-non-deployed-storybooks>Run against non-deployed Storybooks</a></li><li><a href=#whats-the-difference-between-chromatic-and-test-runner>What&rsquo;s the difference between Chromatic and Test runner?</a></li></ol></li><li><a href=#advanced-configuration>Advanced configuration</a><ol><li><a href=#test-hook-api-experimental>Test hook API (experimental)</a></li><li><a href=#storiesjson-mode>Stories.json mode</a></li></ol></li><li><a href=#troubleshooting>Troubleshooting</a><ol><li><a href=#the-test-runner-seems-flaky-and-keeps-timing-out>The test runner seems flaky and keeps timing out</a></li><li><a href=#the-error-output-in-the-cli-is-too-short>The error output in the CLI is too short</a></li><li><a href=#run-the-test-runner-in-other-ci-environments>Run the test runner in other CI environments</a></li></ol></li></ol></nav></details></aside><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-toc data-lang=toc><span class=line><span class=cl>style: bullet
</span></span></code></pre></td></tr></table></div></div><p>Storybook test runner turns all of your stories into executable tests. It is powered by
<a href=https://jestjs.io/ rel=noopener>Jest</a> and
<a href=https://playwright.dev/ rel=noopener>Playwright</a>.</p><ul><li>For those
<a href=https://storybook.js.org/docs/react/writing-stories/introduction rel=noopener>without a play function</a>: it verifies whether the story renders without any errors.</li><li>For those
<a href=https://storybook.js.org/docs/react/writing-stories/play-function rel=noopener>with a play function</a>: it also checks for errors in the play function and that all assertions passed.</li></ul><p>These tests run in a live browser and can be executed via the
<a href=https://storybook.js.org/docs/react/writing-tests/test-runner#cli-options rel=noopener>command line</a> or your
<a href=https://storybook.js.org/docs/react/writing-tests/test-runner#set-up-ci-to-run-tests rel=noopener>CI server</a>.</p><a href=#setup><h2 id=setup><span class=hanchor arialabel=Anchor># </span>Setup</h2></a><p>The test-runner is a standalone, framework-agnostic utility that runs parallel to your Storybook. You will need to take some additional steps to set it up properly. Detailed below is our recommendation to configure and execute it.</p><p>Run the following command to install it.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yarn add --dev @storybook/test-runner
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>npm install @storybook/test-runner --save-dev
</span></span></code></pre></td></tr></table></div></div><p>Update your <code>package.json</code> scripts and enable the test runner.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=nt>&#34;scripts&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;test-storybook&#34;</span><span class=p>:</span> <span class=s2>&#34;test-storybook&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Start your Storybook with:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yarn storybook
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>npm run storybook
</span></span></code></pre></td></tr></table></div></div><blockquote><p>💡 Storybook&rsquo;s test runner requires either a locally running Storybook instance or a published Storybook to run all the existing tests.</p></blockquote><p>Finally, open a new terminal window and run the test-runner with:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yarn test-storybook
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>npm run test-storybook
</span></span></code></pre></td></tr></table></div></div><a href=#configure><h2 id=configure><span class=hanchor arialabel=Anchor># </span>Configure</h2></a><p>Test runner offers zero-config support for Storybook. However, you can run <code>test-storybook --eject</code> for more fine-grained control. It generates a <code>test-runner-jest.config.js</code> file at the root of your project, which you can modify. Additionally, you can extend the generated configuration file and provide
<a href=https://github.com/playwright-community/jest-playwright#configuration rel=noopener>testEnvironmentOptions</a> as the test runner also uses
<a href=https://github.com/playwright-community/jest-playwright rel=noopener>jest-playwright</a> under the hood.</p><a href=#cli-options><h3 id=cli-options><span class=hanchor arialabel=Anchor># </span>CLI Options</h3></a><p>The test-runner is powered by
<a href=https://jestjs.io/ rel=noopener>Jest</a> and accepts a subset of its
<a href=https://jestjs.io/docs/cli rel=noopener>CLI options</a> (for example, <code>--watch</code>, <code>--maxWorkers</code>). If you&rsquo;re already using any of those flags in your project, you should be able to migrate them into Storybook&rsquo;s test-runner without any issues. Listed below are all the available flags and examples of using them.</p><table><thead><tr><th>Options</th><th>Description</th></tr></thead><tbody><tr><td><code>--help</code></td><td>Output usage information<br><code>test-storybook --help</code></td></tr><tr><td><code>-s</code>, <code>--stories-json</code></td><td>Run in stories json mode. Automatically detected (requires a compatible Storybook)<br><code>test-storybook --stories-json</code></td></tr><tr><td><code>--no-stories-json</code></td><td>Disables stories json mode<br><code>test-storybook --no-stories-json</code></td></tr><tr><td><code>-c</code>, <code>--config-dir [dir-name]</code></td><td>Directory where to load Storybook configurations from<br><code>test-storybook -c .storybook</code></td></tr><tr><td><code>--watch</code></td><td>Run in watch mode<br><code>test-storybook --watch</code></td></tr><tr><td><code>--url</code></td><td>Define the URL to run tests in. Useful for custom Storybook URLs<br><code>test-storybook --url http://the-storybook-url-here.com</code></td></tr><tr><td><code>--browsers</code></td><td>Define browsers to run tests in. One or multiple of: chromium, firefox, webkit<br><code>test-storybook --browsers firefox chromium</code></td></tr><tr><td><code>--maxWorkers [amount]</code></td><td>Specifies the maximum number of workers the worker-pool will spawn for running tests<br><code>test-storybook --maxWorkers=2</code></td></tr><tr><td><code>--no-cache</code></td><td>Disable the cache<br><code>test-storybook --no-cache</code></td></tr><tr><td><code>--clearCache</code></td><td>Deletes the Jest cache directory and then exits without running tests<br><code>test-storybook --clearCache</code></td></tr><tr><td><code>--verbose</code></td><td>Display individual test results with the test suite hierarchy<br><code>test-storybook --verbose</code></td></tr><tr><td><code>-u</code>, <code>--updateSnapshot</code></td><td>Use this flag to re-record every snapshot that fails during this test run<br><code>test-storybook -u</code></td></tr><tr><td><code>--eject</code></td><td>Creates a local configuration file to override defaults of the test-runner<br><code>test-storybook --eject</code></td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yarn test-storybook --watch
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>npm run test-storybook -- --watch
</span></span></code></pre></td></tr></table></div></div><a href=#run-tests-against-a-deployed-storybook><h3 id=run-tests-against-a-deployed-storybook><span class=hanchor arialabel=Anchor># </span>Run tests against a deployed Storybook</h3></a><p>By default, the test-runner assumes that you&rsquo;re running it against a locally served Storybook on port <code>6006</code>. If you want to define a target URL to run against deployed Storybooks, you can use the <code>--url</code> flag or set the <code>TARGET_URL</code> environment variable. For example:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yarn test-storybook --url https://the-storybook-url-here.com
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>npm run test-storybook -- --url https://the-storybook-url-here.com
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>TARGET_URL=https://the-storybook-url-here.com yarn test-storybook
</span></span></code></pre></td></tr></table></div></div><a href=#set-up-ci-to-run-tests><h2 id=set-up-ci-to-run-tests><span class=hanchor arialabel=Anchor># </span>Set up CI to run tests</h2></a><p>You can also configure the test-runner to run tests on a CI environment. Documented below are some recipes to help you get started.</p><a href=#run-against-deployed-storybooks-via-github-actions-deployment><h3 id=run-against-deployed-storybooks-via-github-actions-deployment><span class=hanchor arialabel=Anchor># </span>Run against deployed Storybooks via Github Actions deployment</h3></a><p>If you&rsquo;re publishing your Storybook with services such as
<a href=https://vercel.com/ rel=noopener>Vercel</a> or
<a href=https://www.netlify.com/ rel=noopener>Netlify</a>, they emit a <code>deployment_status</code> event in GitHub Actions. You can use it and set the <code>deployment_status.target_url</code> as the <code>TARGET_URL</code> environment variable. Here&rsquo;s how:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=c># .github/workflows/storybook-tests.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Storybook Tests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>deployment_status</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout-minutes</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>if</span><span class=p>:</span><span class=w> </span><span class=l>github.event.deployment_status.state == &#39;success&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-node@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;14.x&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install dependencies</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>yarn</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install Playwright</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>npx playwright install --with-deps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Run Storybook tests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>yarn test-storybook</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>TARGET_URL</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;${{ github.event.deployment_status.target_url }}&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>💡 The published Storybook must be publicly available for this example to work. We recommend running the test server using the recipe
<a href=https://storybook.js.org/docs/react/writing-tests/test-runner#run-against-non-deployed-storybooks rel=noopener>below</a> if it requires authentication.</p></blockquote><a href=#run-against-non-deployed-storybooks><h3 id=run-against-non-deployed-storybooks><span class=hanchor arialabel=Anchor># </span>Run against non-deployed Storybooks</h3></a><p>You can use your CI provider (for example,
<a href=https://github.com/features/actions rel=noopener>GitHub Actions</a>,
<a href=https://docs.gitlab.com/ee/ci/pipelines/ rel=noopener>GitLab Pipelines</a>,
<a href=https://circleci.com/ rel=noopener>CircleCI</a>) to build and run the test runner against your built Storybook. Here&rsquo;s a recipe that relies on third-party libraries, that is to say,
<a href=https://www.npmjs.com/package/concurrently rel=noopener>concurrently</a>,
<a href=https://www.npmjs.com/package/http-server rel=noopener>http-server</a>, and
<a href=https://www.npmjs.com/package/wait-on rel=noopener>wait-on</a> to build Storybook and run tests with the test-runner.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl><span class=c># .github/workflows/storybook-tests.yml</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;Storybook Tests&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w> </span><span class=l>push</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>test</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>timeout-minutes</span><span class=p>:</span><span class=w> </span><span class=m>60</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/setup-node@v2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>with</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>          </span><span class=nt>node-version</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;14.x&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install dependencies</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>yarn</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install Playwright</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>npx playwright install --with-deps</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Build Storybook</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>yarn build-storybook --quiet</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Serve Storybook and run tests</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=p>|</span><span class=sd>
</span></span></span><span class=line><span class=cl><span class=sd>          npx concurrently -k -s first -n &#34;SB,TEST&#34; -c &#34;magenta,blue&#34; \
</span></span></span><span class=line><span class=cl><span class=sd>            &#34;npx http-server storybook-static --port 6006 --silent&#34; \
</span></span></span><span class=line><span class=cl><span class=sd>            &#34;npx wait-on tcp:6006 &amp;&amp; yarn test-storybook&#34;</span><span class=w>          
</span></span></span></code></pre></td></tr></table></div></div><blockquote><p>💡 By default Storybook outputs the
<a href=https://storybook.js.org/docs/react/sharing/publish-storybook#build-storybook-as-a-static-web-application rel=noopener>build</a> to the <code>storybook-static</code> directory. If you&rsquo;re using a different build directory, you&rsquo;ll need to adjust the recipe accordingly.</p></blockquote><a href=#whats-the-difference-between-chromatic-and-test-runner><h3 id=whats-the-difference-between-chromatic-and-test-runner><span class=hanchor arialabel=Anchor># </span>What&rsquo;s the difference between Chromatic and Test runner?</h3></a><p>The test-runner is a generic testing tool that can run locally or on CI and be configured or extended to run all kinds of tests.</p><p><a href=https://www.chromatic.com/ rel=noopener>Chromatic</a> is a cloud-based service that runs
<a href=https://storybook.js.org/docs/react/writing-tests/visual-testing rel=noopener>visual</a> and
<a href=https://storybook.js.org/docs/react/writing-tests/interaction-testing rel=noopener>interaction tests</a> (and soon accessibility tests) without setting up the test runner. It also syncs with your git provider and manages access control for private projects.</p><p>However, you might want to pair the test runner and Chromatic in some cases.</p><ul><li>Use it locally and Chromatic on your CI.</li><li>Use Chromatic for visual and interaction tests and run other custom tests using the test runner.</li></ul><a href=#advanced-configuration><h2 id=advanced-configuration><span class=hanchor arialabel=Anchor># </span>Advanced configuration</h2></a><a href=#test-hook-api-experimental><h3 id=test-hook-api-experimental><span class=hanchor arialabel=Anchor># </span>Test hook API (experimental)</h3></a><p>The test-runner renders a story and executes its
<a href=https://storybook.js.org/docs/react/writing-stories/play-function rel=noopener>play function</a> if one exists. However, certain behaviors are impossible to achieve via the play function, which executes in the browser. For example, if you want the test-runner to take visual snapshots for you, this is possible via Playwright/Jest but must be executed in Node.</p><p>The test-runner exports test hooks that can be overridden globally to enable use cases like visual or DOM snapshots. These hooks give you access to the test lifecycle <em>before</em> and <em>after</em> the story is rendered. Listed below are the available hooks and an overview of how to use them.</p><table><thead><tr><th>Hook</th><th>Description</th></tr></thead><tbody><tr><td><code>setup</code></td><td>Executes once before all the tests run<br><code>setup() {}</code></td></tr><tr><td><code>preRender</code></td><td>Executes before a story is rendered<br><code>async preRender(page, context) {}</code></td></tr><tr><td><code>postRender</code></td><td>Executes after the story is rendered<br><code>async postRender(page, context) {}</code></td></tr></tbody></table><blockquote><p>💡 These test hooks are experimental and may be subject to breaking changes. We encourage you to test as much as possible within the story&rsquo;s
<a href=https://storybook.js.org/docs/react/writing-stories/play-function rel=noopener>play function</a>.</p></blockquote><p>To enable the hooks API, you&rsquo;ll need to add a new configuration file inside your Storybook directory and set them up as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=c1>// .storybook/test-runner.js
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>module</span><span class=p>.</span><span class=nx>exports</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Hook that is executed before the test runner starts running tests
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>setup</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Add your configuration here.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=cm>/* Hook to execute before a story is rendered.
</span></span></span><span class=line><span class=cl><span class=cm>   * The page argument is the Playwright&#39;s page object for the story.
</span></span></span><span class=line><span class=cl><span class=cm>   * The context argument is a Storybook object containing the story&#39;s id, title, and name.
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>preRender</span><span class=p>(</span><span class=nx>page</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Add your configuration here.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=cm>/* Hook to execute after a story is rendered.
</span></span></span><span class=line><span class=cl><span class=cm>   * The page argument is the Playwright&#39;s page object for the story
</span></span></span><span class=line><span class=cl><span class=cm>   * The context argument is a Storybook object containing the story&#39;s id, title, and name.
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>postRender</span><span class=p>(</span><span class=nx>page</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Add your configuration here.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-ts data-lang=ts><span class=line><span class=cl><span class=c1>// .storybook/test-runner.ts
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=kr>import</span> <span class=kr>type</span> <span class=p>{</span> <span class=nx>TestRunnerConfig</span> <span class=p>}</span> <span class=kr>from</span> <span class=s1>&#39;@storybook/test-runner&#39;</span><span class=p>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>const</span> <span class=nx>config</span>: <span class=kt>TestRunnerConfig</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=c1>// Hook that is executed before the test runner starts running tests
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=nx>setup() {</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Add your configuration here.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=cm>/* Hook to execute before a story is rendered.
</span></span></span><span class=line><span class=cl><span class=cm>   * The page argument is the Playwright&#39;s page object for the story.
</span></span></span><span class=line><span class=cl><span class=cm>   * The context argument is a Storybook object containing the story&#39;s id, title, and name.
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>preRender</span><span class=p>(</span><span class=nx>page</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Add your configuration here.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl>  <span class=cm>/* Hook to execute after a story is rendered.
</span></span></span><span class=line><span class=cl><span class=cm>   * The page argument is the Playwright&#39;s page object for the story
</span></span></span><span class=line><span class=cl><span class=cm>   * The context argument is a Storybook object containing the story&#39;s id, title, and name.
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kr>async</span> <span class=nx>postRender</span><span class=p>(</span><span class=nx>page</span><span class=p>,</span> <span class=nx>context</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Add your configuration here.
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=p>},</span>
</span></span><span class=line><span class=cl><span class=p>};</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kr>module</span><span class=nx>.exports</span> <span class=o>=</span> <span class=nx>config</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><blockquote><p>💡 Except for the <code>setup</code> function, all other functions run asynchronously. Both <code>preRender</code> and <code>postRender</code> functions include two additional arguments, a
<a href=https://playwright.dev/docs/pages rel=noopener>Playwright page</a> and a context object which contains the <code>id</code>, <code>title</code>, and the <code>name</code> of the story.</p></blockquote><p>When the test-runner executes, your existing tests will go through the following lifecycle:</p><ul><li>The <code>setup</code> function is executed before all the tests run.</li><li>The context object is generated containing the required information.</li><li>Playwright navigates to the story&rsquo;s page.</li><li>The <code>preRender</code> function is executed.</li><li>The story is rendered, and any existing <code>play</code> functions are executed.</li><li>The <code>postRender</code> function is executed.</li></ul><a href=#storiesjson-mode><h3 id=storiesjson-mode><span class=hanchor arialabel=Anchor># </span>Stories.json mode</h3></a><p>The test-runner transforms your story files into tests when testing a local Storybook. For a remote Storybook, it uses the Storybook&rsquo;s
<a href=https://storybook.js.org/docs/react/configure/overview#feature-flags rel=noopener>stories.json</a> file (a static index of all the stories) to run the tests.</p><a href=#why><h4 id=why><span class=hanchor arialabel=Anchor># </span>Why?</h4></a><p>Suppose you run into a situation where the local and remote Storybooks appear out of sync, or you might not even have access to the code. In that case, the <code>stories.json</code> file is guaranteed to be the most accurate representation of the deployed Storybook you are testing. To test a local Storybook using this feature, use the <code>--stories-json</code> flag as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yarn test-storybook --stories-json
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>npm run test-storybook -- --stories-json
</span></span></code></pre></td></tr></table></div></div><blockquote><p>💡 The <code>stories.json</code> mode is not compatible with watch mode.</p></blockquote><p>If you need to disable it, use the <code>--no-stories-json</code> flag:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>yarn test-storybook --no-stories-json
</span></span></code></pre></td></tr></table></div></div><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>npm run test-storybook -- --no-stories-json
</span></span></code></pre></td></tr></table></div></div><a href=#how-do-i-check-if-my-storybook-has-a-storiesjson-file><h4 id=how-do-i-check-if-my-storybook-has-a-storiesjson-file><span class=hanchor arialabel=Anchor># </span>How do I check if my Storybook has a <code>stories.json</code> file?</h4></a><p>Stories.json mode requires a <code>stories.json</code> file. Open a browser window and navigate to your deployed Storybook instance (for example, <code>https://your-storybook-url-here.com/stories.json</code>). You should see a JSON file that starts with a <code>"v": 3</code> key, immediately followed by another key called &ldquo;stories&rdquo;, which contains a map of story IDs to JSON objects. If that is the case, your Storybook supports
<a href=https://storybook.js.org/docs/react/configure/overview#feature-flags rel=noopener>stories.json mode</a>.</p><hr><a href=#troubleshooting><h2 id=troubleshooting><span class=hanchor arialabel=Anchor># </span>Troubleshooting</h2></a><a href=#the-test-runner-seems-flaky-and-keeps-timing-out><h3 id=the-test-runner-seems-flaky-and-keeps-timing-out><span class=hanchor arialabel=Anchor># </span>The test runner seems flaky and keeps timing out</h3></a><p>If your tests time out with the following message:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>Timeout - Async callback was not invoked within the <span class=m>15000</span> ms timeout specified by jest.setTimeout
</span></span></code></pre></td></tr></table></div></div><p>It might be that Playwright couldn&rsquo;t handle testing the number of stories you have in your project. Perhaps you have a large number of stories, or your CI environment has a really low RAM configuration. In such cases, you should limit the number of workers that run in parallel by adjusting your command as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-js data-lang=js><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=s2>&#34;scripts&#34;</span><span class=o>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;test-storybook:ci&#34;</span><span class=o>:</span> <span class=s2>&#34;yarn test-storybook --maxWorkers=2&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><a href=#the-error-output-in-the-cli-is-too-short><h3 id=the-error-output-in-the-cli-is-too-short><span class=hanchor arialabel=Anchor># </span>The error output in the CLI is too short</h3></a><p>By default, the test runner truncates error outputs at 1000 characters, and you can check the full output directly in Storybook in the browser. However, if you want to change that limit, you can do so by setting the <code>DEBUG_PRINT_LIMIT</code> environment variable to a number of your choosing, for example, <code>DEBUG_PRINT_LIMIT=5000 yarn test-storybook</code>.</p><a href=#run-the-test-runner-in-other-ci-environments><h3 id=run-the-test-runner-in-other-ci-environments><span class=hanchor arialabel=Anchor># </span>Run the test runner in other CI environments</h3></a><p>As the test runner is based on Playwright, you might need to use specific docker images or other configurations depending on your CI setup. In that case, you can refer to the
<a href=https://playwright.dev/docs/ci rel=noopener>Playwright CI docs</a> for more information.</p><a href=#learn-about-other-ui-tests><h4 id=learn-about-other-ui-tests><span class=hanchor arialabel=Anchor># </span>Learn about other UI tests</h4></a><ul><li>Test runner to automate test execution</li><li><a href=https://storybook.js.org/docs/react/writing-tests/visual-testing rel=noopener>Visual tests</a> for appearance</li><li><a href=https://storybook.js.org/docs/react/writing-tests/accessibility-testing rel=noopener>Accessibility tests</a> for accessibility</li><li><a href=https://storybook.js.org/docs/react/writing-tests/interaction-testing rel=noopener>Interaction tests</a> for user behavior simulation</li><li><a href=https://storybook.js.org/docs/react/writing-tests/snapshot-testing rel=noopener>Snapshot tests</a> for rendering errors and warnings</li><li><a href=https://storybook.js.org/docs/react/writing-tests/importing-stories-in-tests rel=noopener>Import stories in other tests</a> for other tools</li></ul><p><a href=https://github.com/storybookjs/storybook/tree/next/docs/writing-tests/test-runner.md target=_blank rel=noopener class="e1soj9vu1 e1ja7avb2 css-1ii1tfm e1ja7avb1"><span class="css-1xdhyk6 e1ja7avb3"><span role=img aria-label=write>✍️</span> Edit on GitHub – PRs welcome!</span></a></p></article><hr><div class=page-end id=footer><div class=backlinks-container><h3>Backlinks</h3><ul class=backlinks><li>No backlinks found</li></ul></div><div><script src=https://cdn.jsdelivr.net/npm/d3@6.7.0/dist/d3.min.js integrity="sha256-+7jaYCp29O1JusNWHaYtgUn6EhuP0VaFuswhNV06MyI=" crossorigin=anonymous></script><h3>Interactive Graph</h3><div id=graph-container></div><style>:root{--g-node:var(--secondary);--g-node-active:var(--primary);--g-node-inactive:var(--visited);--g-link:var(--outlinegray);--g-link-active:#5a7282}</style><script src=https://mindulle.github.io/garden/js/graph.abd4bc2af3869a96524d7d23b76152c7.js></script></div></div><div id=contact_buttons><footer><p>Made by Mindulle using <a href=https://github.com/jackyzha0/quartz>Quartz</a>, © 2022</p><ul><li><a href=https://mindulle.github.io/garden>Home</a></li><li><a href=https://github.com/mindulle>Github</a></li></ul></footer></div></div></body></html>